<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>WealthVision AI - Institutional Portfolio Management</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #0a0e27 0%, #1a1f3a 100%);
      color: #ffffff;
      line-height: 1.6;
      overflow-x: hidden;
    }
    
    .header {
      background: linear-gradient(135deg, #0a0e27 0%, #1e2347 100%);
      padding: 2rem 0;
      position: sticky;
      top: 0;
      z-index: 100;
      backdrop-filter: blur(10px);
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .header-content {
      max-width: 1400px;
      margin: 0 auto;
      padding: 0 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .logo {
      display: flex;
      align-items: center;
      gap: 1rem;
    }
    
    .logo-icon {
      width: 50px;
      height: 50px;
      background: linear-gradient(135deg, #00d4ff 0%, #0061f2 100%);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 1.5rem;
    }
    
    .logo-text h1 {
      font-size: 2rem;
      font-weight: 700;
      background: linear-gradient(135deg, #00d4ff 0%, #ffffff 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .logo-text p {
      font-size: 0.9rem;
      color: #8892b0;
      margin-top: -0.2rem;
    }
    
    .nav {
      display: flex;
      gap: 2rem;
    }
    
    .nav-item {
      color: #ccd6f6;
      text-decoration: none;
      font-weight: 500;
      transition: color 0.3s ease;
    }
    
    .nav-item:hover {
      color: #00d4ff;
    }
    
    .user-info {
      display: flex;
      align-items: center;
      gap: 1rem;
    }
    
    .user-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: linear-gradient(135deg, #00d4ff 0%, #0061f2 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
    }
    
    .main-container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 3rem 2rem;
    }
    
    .dashboard-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 2rem;
      margin-bottom: 3rem;
    }
    
    .portfolio-summary {
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.05) 100%);
      border-radius: 20px;
      padding: 2rem;
      border: 1px solid rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
    }
    
    .portfolio-value {
      font-size: 3rem;
      font-weight: 700;
      color: #00d4ff;
      margin-bottom: 0.5rem;
    }
    
    .portfolio-change {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      color: #00ff88;
      font-weight: 600;
    }
    
    .recommendation-card {
      background: linear-gradient(135deg, rgba(0, 97, 242, 0.1) 0%, rgba(0, 212, 255, 0.05) 100%);
      border-radius: 20px;
      padding: 2rem;
      border: 1px solid rgba(0, 212, 255, 0.2);
      backdrop-filter: blur(10px);
      position: relative;
      overflow: hidden;
    }
    
    .recommendation-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, #00d4ff 0%, #0061f2 100%);
    }
    
    .alert-badge {
      background: linear-gradient(135deg, #ff6b6b 0%, #ff8e8e 100%);
      color: white;
      padding: 0.5rem 1rem;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 600;
      display: inline-block;
      margin-bottom: 1rem;
    }
    
    .chart-container {
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.05) 0%, rgba(255, 255, 255, 0.02) 100%);
      border-radius: 20px;
      padding: 2rem;
      margin: 2rem 0;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .technical-analysis {
      background: linear-gradient(135deg, rgba(0, 255, 136, 0.1) 0%, rgba(0, 255, 136, 0.05) 100%);
      border-radius: 20px;
      padding: 2rem;
      margin: 2rem 0;
      border: 1px solid rgba(0, 255, 136, 0.2);
    }
    
    .explanation-panel {
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.08) 0%, rgba(255, 255, 255, 0.03) 100%);
      border-radius: 20px;
      padding: 2rem;
      margin: 2rem 0;
      border: 1px solid rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(15px);
      display: none;
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #0061f2 0%, #00d4ff 100%);
      color: white;
      padding: 1rem 2rem;
      border: none;
      border-radius: 12px;
      font-weight: 600;
      cursor: pointer;
      font-size: 1rem;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(0, 97, 242, 0.3);
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(0, 97, 242, 0.4);
    }
    
    .btn-secondary {
      background: rgba(255, 255, 255, 0.1);
      color: #ccd6f6;
      padding: 1rem 2rem;
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 12px;
      font-weight: 600;
      cursor: pointer;
      font-size: 1rem;
      transition: all 0.3s ease;
      margin-left: 1rem;
    }
    
    .btn-secondary:hover {
      background: rgba(255, 255, 255, 0.2);
    }
    
    .metric-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1.5rem;
      margin: 2rem 0;
    }
    
    .metric-card {
      background: rgba(255, 255, 255, 0.05);
      padding: 1.5rem;
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      text-align: center;
    }
    
    .metric-value {
      font-size: 2rem;
      font-weight: 700;
      color: #00d4ff;
      margin-bottom: 0.5rem;
    }
    
    .metric-label {
      color: #8892b0;
      font-size: 0.9rem;
    }
    
    .risk-indicators {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 1rem;
      margin: 1.5rem 0;
    }
    
    .risk-item {
      background: rgba(255, 255, 255, 0.05);
      padding: 1rem;
      border-radius: 8px;
      border-left: 4px solid #00d4ff;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .risk-score {
      font-weight: 700;
      color: #00ff88;
    }
    
    .model-details {
      background: rgba(0, 97, 242, 0.1);
      border-radius: 12px;
      padding: 1.5rem;
      margin: 1.5rem 0;
      border: 1px solid rgba(0, 97, 242, 0.2);
    }
    
    .model-details h4 {
      color: #00d4ff;
      margin-bottom: 1rem;
    }
    
    .feature-importance {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1rem;
      margin: 1rem 0;
    }
    
    .feature-item {
      background: rgba(255, 255, 255, 0.05);
      padding: 1rem;
      border-radius: 8px;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .feature-bar {
      height: 4px;
      background: linear-gradient(90deg, #00d4ff 0%, #0061f2 100%);
      border-radius: 2px;
      margin-top: 0.5rem;
    }
    
    .confidence-meter {
      margin: 2rem 0;
      padding: 1.5rem;
      background: rgba(0, 255, 136, 0.1);
      border-radius: 12px;
      border: 1px solid rgba(0, 255, 136, 0.2);
    }
    
    .confidence-bar {
      height: 8px;
      background: linear-gradient(90deg, #00ff88 0%, #00d4ff 100%);
      border-radius: 4px;
      width: 87.4%;
      margin: 1rem 0;
    }
    
    .footer {
      background: linear-gradient(135deg, #0a0e27 0%, #1e2347 100%);
      padding: 3rem 0;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      margin-top: 4rem;
    }
    
    .footer-content {
      max-width: 1400px;
      margin: 0 auto;
      padding: 0 2rem;
      text-align: center;
    }
    
    .footer-links {
      display: flex;
      justify-content: center;
      gap: 2rem;
      margin-bottom: 2rem;
    }
    
    .footer-links a {
      color: #8892b0;
      text-decoration: none;
      transition: color 0.3s ease;
    }
    
    .footer-links a:hover {
      color: #00d4ff;
    }
    
    .animate-fade-in {
      animation: fadeIn 0.8s ease-in-out;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .pulse {
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }
    
    canvas {
      max-width: 100%;
      max-height: 400px !important;
    }
    
    @media (max-width: 768px) {
      .dashboard-grid {
        grid-template-columns: 1fr;
      }
      
      .header-content {
        flex-direction: column;
        gap: 1rem;
      }
      
      .nav {
        flex-wrap: wrap;
        gap: 1rem;
      }
      
      .portfolio-value {
        font-size: 2rem;
      }
    }
  </style>
</head>
<body>
  <header class="header">
    <div class="header-content">
      <div class="logo">
        <div class="logo-icon">WV</div>
        <div class="logo-text">
          <h1>WealthVision AI</h1>
          <p>Institutional Portfolio Intelligence</p>
        </div>
      </div>
      <nav class="nav">
        <a href="#" class="nav-item">Portfolio</a>
        <a href="#" class="nav-item">Analytics</a>
        <a href="#" class="nav-item">Research</a>
        <a href="#" class="nav-item">Reports</a>
        <a href="#" class="nav-item">Settings</a>
      </nav>
      <div class="user-info">
        <div class="user-avatar">JD</div>
        <div>
          <div style="font-weight: 600;">John Doe</div>
          <div style="font-size: 0.8rem; color: #8892b0;">Private Client</div>
        </div>
      </div>
    </div>
  </header>

  <div class="main-container">
    <div class="dashboard-grid">
      <div class="portfolio-summary animate-fade-in">
        <h2>Portfolio Valuation</h2>
        <div class="portfolio-value">$24.7M</div>
        <div class="portfolio-change">
          <span>↗</span> +$347K (1.42%) Today
        </div>
        <div class="metric-grid" style="grid-template-columns: repeat(2, 1fr); margin-top: 1.5rem;">
          <div style="text-align: center;">
            <div style="font-size: 1.2rem; font-weight: 600; color: #00d4ff;">12.3%</div>
            <div style="font-size: 0.8rem; color: #8892b0;">YTD Return</div>
          </div>
          <div style="text-align: center;">
            <div style="font-size: 1.2rem; font-weight: 600; color: #00ff88;">0.87</div>
            <div style="font-size: 0.8rem; color: #8892b0;">Sharpe Ratio</div>
          </div>
        </div>
      </div>

      <div class="recommendation-card animate-fade-in">
        <div class="alert-badge pulse">HIGH PRIORITY</div>
        <h3>AI Strategic Rebalancing Alert</h3>
        <p>Multi-factor quantitative analysis indicates suboptimal risk-adjusted returns in current Tech allocation. Immediate portfolio restructuring recommended.</p>
        <div style="margin-top: 1rem;">
          <strong>Confidence Score: 87.4%</strong>
          <div style="background: rgba(255,255,255,0.1); height: 4px; border-radius: 2px; margin: 0.5rem 0;">
            <div style="background: linear-gradient(90deg, #00ff88 0%, #00d4ff 100%); height: 100%; width: 87.4%; border-radius: 2px;"></div>
          </div>
        </div>
      </div>
    </div>

    <div class="chart-container animate-fade-in">
      <h3>Portfolio Allocation Analysis</h3>
      <div style="position: relative; height: 400px; width: 100%;">
        <canvas id="portfolioChart"></canvas>
      </div>
    </div>

    <div class="technical-analysis animate-fade-in">
      <h3>Quantitative Risk Metrics</h3>
      <div class="risk-indicators">
        <div class="risk-item">
          <span>Value at Risk (95%)</span>
          <span class="risk-score">$1.2M</span>
        </div>
        <div class="risk-item">
          <span>Beta (S&P 500)</span>
          <span class="risk-score">0.94</span>
        </div>
        <div class="risk-item">
          <span>Volatility (30d)</span>
          <span class="risk-score">14.2%</span>
        </div>
        <div class="risk-item">
          <span>Max Drawdown</span>
          <span class="risk-score">-8.7%</span>
        </div>
        <div class="risk-item">
          <span>Correlation (QQQ)</span>
          <span class="risk-score">0.73</span>
        </div>
        <div class="risk-item">
          <span>Tracking Error</span>
          <span class="risk-score">3.8%</span>
        </div>
      </div>
    </div>

    <div style="text-align: center; margin: 2rem 0;">
      <button class="btn-primary" onclick="showExplanation()">Deep Dive Analysis</button>
      <button class="btn-secondary" onclick="generateReport()">Generate Report</button>
    </div>

    <div class="explanation-panel" id="explanationBox">
      <h3>Advanced Model Interpretability & Decision Framework</h3>
      
      <div class="confidence-meter">
        <h4>AI Confidence Assessment</h4>
        <p>Model certainty based on ensemble voting and cross-validation metrics</p>
        <div class="confidence-bar"></div>
        <div style="display: flex; justify-content: space-between; margin-top: 0.5rem;">
          <span>Confidence: 87.4%</span>
          <span>Threshold: 85%</span>
        </div>
      </div>

      <div class="model-details">
        <h4>1. Model Interpretability Frameworks (SHAP, LIME)</h4>
        <p><strong>SHAP (Shapley Additive Explanations):</strong> Quantifies individual feature contributions to model predictions</p>
        <p><strong>LIME (Local Interpretable Model-Agnostic Explanations):</strong> Provides local explanations around specific predictions</p>
        
        <h5>Feature Importance Analysis (SHAP Values):</h5>
        <div class="feature-importance">
          <div class="feature-item">
            <div style="display: flex; justify-content: space-between;">
              <span>Tech Sector Volatility</span>
              <span style="color: #ff6b6b;">+0.42</span>
            </div>
            <div class="feature-bar" style="width: 84%;"></div>
          </div>
          <div class="feature-item">
            <div style="display: flex; justify-content: space-between;">
              <span>Risk Aversion Profile</span>
              <span style="color: #00ff88;">-0.33</span>
            </div>
            <div class="feature-bar" style="width: 66%;"></div>
          </div>
          <div class="feature-item">
            <div style="display: flex; justify-content: space-between;">
              <span>NASDAQ Momentum</span>
              <span style="color: #ff6b6b;">+0.27</span>
            </div>
            <div class="feature-bar" style="width: 54%;"></div>
          </div>
          <div class="feature-item">
            <div style="display: flex; justify-content: space-between;">
              <span>VIX Term Structure</span>
              <span style="color: #ff6b6b;">+0.19</span>
            </div>
            <div class="feature-bar" style="width: 38%;"></div>
          </div>
        </div>
      </div>

      <div class="model-details">
        <h4>2. Confidence Scoring & Thresholding</h4>
        <p><strong>Ensemble Confidence:</strong> Weighted voting across multiple model predictions</p>
        <p><strong>Uncertainty Quantification:</strong> Bayesian posterior distributions for prediction intervals</p>
        <p><strong>Threshold Mechanisms:</strong> Action triggers based on confidence levels and risk parameters</p>
        
        <h5>Confidence Metrics:</h5>
        <div class="metric-grid">
          <div class="metric-card">
            <div class="metric-value">87.4%</div>
            <div class="metric-label">Model Confidence</div>
          </div>
          <div class="metric-card">
            <div class="metric-value">85%</div>
            <div class="metric-label">Action Threshold</div>
          </div>
          <div class="metric-card">
            <div class="metric-value">92%</div>
            <div class="metric-label">Ensemble Agreement</div>
          </div>
          <div class="metric-card">
            <div class="metric-value">5.2%</div>
            <div class="metric-label">Volatility Trigger</div>
          </div>
        </div>
      </div>

      <div class="model-details">
        <h4>3. Visual Explanation Modules</h4>
        <p><strong>Interactive Visualizations:</strong> Dynamic charts showing feature contributions and decision boundaries</p>
        <p><strong>Decision Trees:</strong> Hierarchical explanation of model reasoning paths</p>
        <p><strong>Counterfactual Analysis:</strong> What-if scenarios showing alternative outcomes</p>
        
        <h5>Visualization Components:</h5>
        <div class="risk-indicators">
          <div class="risk-item">
            <span>Feature Importance Charts</span>
            <span class="risk-score">Active</span>
          </div>
          <div class="risk-item">
            <span>Decision Boundary Plots</span>
            <span class="risk-score">Active</span>
          </div>
          <div class="risk-item">
            <span>Confidence Intervals</span>
            <span class="risk-score">Active</span>
          </div>
          <div class="risk-item">
            <span>Sensitivity Analysis</span>
            <span class="risk-score">Active</span>
          </div>
          <div class="risk-item">
            <span>Correlation Matrices</span>
            <span class="risk-score">Active</span>
          </div>
          <div class="risk-item">
            <span>Scenario Comparisons</span>
            <span class="risk-score">Active</span>
          </div>
        </div>
        
        <div style="background: rgba(0, 212, 255, 0.1); padding: 1rem; border-radius: 8px; border-left: 4px solid #00d4ff; margin-top: 1rem;">
          <h5>Recommendation Summary:</h5>
          <p><strong>Action:</strong> Reduce Tech exposure from 45% to 25% (-20%)</p>
          <p><strong>Reallocation:</strong> Healthcare +10%, Finance +7%, Energy +3%</p>
          <p><strong>Expected Impact:</strong> Sharpe ratio improvement from 0.87 to 1.12</p>
          <p><strong>Risk Reduction:</strong> Portfolio volatility decrease from 14.2% to 11.8%</p>
          <p><strong>Execution Timeline:</strong> 5-day TWAP implementation to minimize market impact</p>
        </div>
      </div>

      <div class="model-details">
        <h4>Compliance & Regulatory Framework</h4>
        <p><strong>MiFID II Compliance:</strong> Best execution and transaction cost analysis</p>
        <p><strong>Fiduciary Standards:</strong> Documented decision rationale and client suitability</p>
        <p><strong>Risk Management:</strong> Position limits, concentration limits, and drawdown controls</p>
        
        <div style="margin-top: 1rem;">
          <p><strong>Model Validation:</strong> Quarterly backtesting, walk-forward analysis, and out-of-sample testing</p>
          <p><strong>Audit Trail:</strong> Complete decision history with timestamp and model version tracking</p>
          <p><strong>Performance Attribution:</strong> Factor-based decomposition of returns vs. benchmark</p>
        </div>
      </div>
    </div>
  </div>

  <footer class="footer">
    <div class="footer-content">
      <div class="footer-links">
        <a href="#">Privacy Policy</a>
        <a href="#">Terms of Service</a>
        <a href="#">Risk Disclosures</a>
        <a href="#">Regulatory Information</a>
        <a href="#">Contact</a>
      </div>
      <p>&copy; 2025 WealthVision AI Technologies. All rights reserved.</p>
      <p style="font-size: 0.8rem; color: #8892b0; margin-top: 0.5rem;">
        Securities and advisory services offered through WealthVision AI, LLC. Member SIPC.
      </p>
    </div>
  </footer>

  <!-- Floating Chatbot Button -->
  <button id="openChatbotBtn" style="position: fixed; bottom: 2rem; right: 2rem; z-index: 200; background: linear-gradient(135deg, #0061f2 0%, #00d4ff 100%); color: #fff; border: none; border-radius: 50%; width: 60px; height: 60px; box-shadow: 0 4px 15px rgba(0, 97, 242, 0.3); font-size: 2rem; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: box-shadow 0.3s;">
    💬
  </button>

  <!-- Chatbot Panel (Hidden by default) -->
  <div id="chatbotPanel" style="display: none; position: fixed; bottom: 5.5rem; right: 2rem; z-index: 300; width: 370px; max-width: 95vw; height: 520px; background: linear-gradient(135deg, #0a0e27 0%, #1a1f3a 100%); border-radius: 18px; box-shadow: 0 8px 32px rgba(0,0,0,0.45); border: 1.5px solid rgba(0,212,255,0.18); flex-direction: column; overflow: hidden; resize: none;">
    <div id="chatbotHeader" style="display: flex; align-items: center; justify-content: space-between; background: linear-gradient(135deg, #0a0e27 0%, #1e2347 100%); padding: 1rem 1.2rem; border-bottom: 1px solid rgba(255,255,255,0.08); cursor: move; user-select: none;">
      <div style="font-weight: 700; color: #00d4ff; font-size: 1.1rem; letter-spacing: 0.5px;">Wealth Assistant</div>
      <button id="closeChatbotBtn" style="background: none; border: none; color: #ccd6f6; font-size: 1.5rem; cursor: pointer;">&times;</button>
    </div>
    <div id="chat-window" style="flex: 1; overflow-y: auto; padding: 1rem; background: none; display: flex; flex-direction: column; gap: 0.5rem;">
      <!-- Messages will appear here -->
    </div>
    <form id="chat-form" style="display: flex; gap: 0.5rem; padding: 1rem; background: linear-gradient(135deg, #0a0e27 0%, #1e2347 100%); border-top: 1px solid rgba(255,255,255,0.08);">
      <input id="user-input" type="text" placeholder="Type your message..." style="flex: 1; border: none; border-radius: 8px; padding: 0.7rem 1rem; background: rgba(255,255,255,0.07); color: #fff; font-size: 1rem; outline: none;" autocomplete="off" required />
      <button type="submit" style="background: linear-gradient(135deg, #0061f2 0%, #00d4ff 100%); color: #fff; border: none; border-radius: 8px; padding: 0.7rem 1.2rem; font-weight: 600; cursor: pointer; transition: background 0.3s;">Send</button>
    </form>
    <div id="chatbotResizeHandle"></div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
  <script>
    // Initialize main portfolio chart
    const ctx = document.getElementById('portfolioChart').getContext('2d');
    const portfolioChart = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: ['Technology', 'Healthcare', 'Financial Services', 'Energy', 'Consumer Discretionary', 'Industrials'],
        datasets: [
          {
            label: 'Current Allocation (%)',
            data: [45, 25, 20, 10, 8, 12],
            backgroundColor: 'rgba(0, 97, 242, 0.7)',
            borderColor: '#0061f2',
            borderWidth: 2,
            borderRadius: 8,
            borderSkipped: false
          },
          {
            label: 'Recommended Allocation (%)',
            data: [25, 35, 27, 13, 12, 15],
            backgroundColor: 'rgba(0, 212, 255, 0.7)',
            borderColor: '#00d4ff',
            borderWidth: 2,
            borderRadius: 8,
            borderSkipped: false
          }
        ]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            position: 'top',
            labels: {
              color: '#ffffff',
              font: {
                family: 'Inter',
                size: 14
              }
            }
          },
          tooltip: {
            backgroundColor: 'rgba(0, 0, 0, 0.8)',
            titleColor: '#ffffff',
            bodyColor: '#ffffff',
            borderColor: '#00d4ff',
            borderWidth: 1,
            cornerRadius: 8,
            callbacks: {
              afterLabel: function(context) {
                if (context.datasetIndex === 0) {
                  const current = context.parsed.y;
                  const recommended = context.chart.data.datasets[1].data[context.dataIndex];
                  const change = recommended - current;
                  return `Change: ${change > 0 ? '+' : ''}${change.toFixed(1)}%`;
                }
                return '';
              }
            }
          }
        },
        scales: {
          x: {
            ticks: {
              color: '#ccd6f6',
              font: {
                family: 'Inter',
                size: 12
              }
            },
            grid: {
              color: 'rgba(255, 255, 255, 0.1)'
            }
          },
          y: {
            beginAtZero: true,
            max: 50,
            ticks: {
              color: '#ccd6f6',
              font: {
                family: 'Inter',
                size: 12
              },
              callback: function(value) {
                return value + '%';
              }
            },
            grid: {
              color: 'rgba(255, 255, 255, 0.1)'
            }
          }
        },
        animation: {
          duration: 2000,
          easing: 'easeInOutQuart'
        }
      }
    });

    // Real-time data simulation
    function updatePortfolioData() {
      const portfolioValue = document.querySelector('.portfolio-value');
      const change = document.querySelector('.portfolio-change');
      
      // Simulate real-time updates
      setInterval(() => {
        const currentValue = 24.7;
        const variation = (Math.random() - 0.5) * 0.1;
        const newValue = currentValue + variation;
        const changeValue = variation * 1000;
        const changePercent = (variation / currentValue) * 100;
        
        portfolioValue.textContent = `${newValue.toFixed(1)}M`;
        change.innerHTML = `
          <span>${changeValue > 0 ? '↗' : '↘'}</span> 
          ${changeValue > 0 ? '+' : ''}${Math.abs(changeValue).toFixed(0)}K 
          (${changePercent > 0 ? '+' : ''}${changePercent.toFixed(2)}%) Today
        `;
        change.style.color = changeValue > 0 ? '#00ff88' : '#ff6b6b';
      }, 5000);
    }

    // Advanced analytics functions
    function showExplanation() {
      const panel = document.getElementById('explanationBox');
      panel.style.display = 'block';
      panel.classList.add('animate-fade-in');
      
      // Scroll to the explanation panel
      panel.scrollIntoView({ behavior: 'smooth', block: 'start' });
      
      // Create dynamic confidence visualization
      createConfidenceVisualization();
      
      // Create risk matrix visualization
      createRiskMatrix();
    }

    function createConfidenceVisualization() {
      // Create a small canvas for confidence meter animation
      const confidenceSection = document.querySelector('.confidence-meter');
      const canvas = document.createElement('canvas');
      canvas.width = 400;
      canvas.height = 100;
      canvas.style.width = '100%';
      canvas.style.height = '50px';
      canvas.style.marginTop = '1rem';
      
      const ctx = canvas.getContext('2d');
      const gradient = ctx.createLinearGradient(0, 0, 400, 0);
      gradient.addColorStop(0, '#ff6b6b');
      gradient.addColorStop(0.5, '#ffeb3b');
      gradient.addColorStop(1, '#00ff88');
      
      // Animate confidence meter
      let progress = 0;
      const targetProgress = 0.874;
      
      function animateConfidence() {
        ctx.clearRect(0, 0, 400, 100);
        
        // Background
        ctx.fillStyle = 'rgba(255, 255, 255, 0.1)';
        ctx.fillRect(0, 35, 400, 30);
        
        // Progress bar
        ctx.fillStyle = gradient;
        ctx.fillRect(0, 35, 400 * progress, 30);
        
        // Text
        ctx.fillStyle = '#ffffff';
        ctx.font = '14px Inter';
        ctx.textAlign = 'center';
        ctx.fillText(`${(progress * 100).toFixed(1)}%`, 200, 55);
        
        if (progress < targetProgress) {
          progress += 0.01;
          requestAnimationFrame(animateConfidence);
        }
      }
      
      confidenceSection.appendChild(canvas);
      animateConfidence();
    }

    function createRiskMatrix() {
      // Create risk correlation matrix
      const riskSection = document.querySelector('.technical-analysis');
      const matrixContainer = document.createElement('div');
      matrixContainer.style.marginTop = '2rem';
      matrixContainer.innerHTML = `
        <h4 style="color: #00d4ff; margin-bottom: 1rem;">Asset Correlation Matrix</h4>
        <div id="correlationMatrix" style="display: grid; grid-template-columns: repeat(6, 1fr); gap: 0.5rem; font-size: 0.8rem;"></div>
      `;
      
      const assets = ['Tech', 'Health', 'Finance', 'Energy', 'Consumer', 'Industrial'];
      const correlations = [
        [1.00, 0.23, 0.45, -0.12, 0.67, 0.34],
        [0.23, 1.00, 0.12, 0.08, 0.19, 0.25],
        [0.45, 0.12, 1.00, 0.23, 0.41, 0.52],
        [-0.12, 0.08, 0.23, 1.00, -0.05, 0.18],
        [0.67, 0.19, 0.41, -0.05, 1.00, 0.38],
        [0.34, 0.25, 0.52, 0.18, 0.38, 1.00]
      ];
      
      const matrix = matrixContainer.querySelector('#correlationMatrix');
      
      for (let i = 0; i < assets.length; i++) {
        for (let j = 0; j < assets.length; j++) {
          const cell = document.createElement('div');
          const corr = correlations[i][j];
          cell.textContent = corr.toFixed(2);
          cell.style.padding = '0.5rem';
          cell.style.textAlign = 'center';
          cell.style.borderRadius = '4px';
          cell.style.border = '1px solid rgba(255, 255, 255, 0.1)';
          
          // Color coding based on correlation strength
          if (corr > 0.5) {
            cell.style.backgroundColor = 'rgba(255, 107, 107, 0.3)';
          } else if (corr > 0.2) {
            cell.style.backgroundColor = 'rgba(255, 235, 59, 0.3)';
          } else if (corr < -0.1) {
            cell.style.backgroundColor = 'rgba(0, 255, 136, 0.3)';
          } else {
            cell.style.backgroundColor = 'rgba(255, 255, 255, 0.05)';
          }
          
          matrix.appendChild(cell);
        }
      }
      
      riskSection.appendChild(matrixContainer);
    }

    function generateReport() {
      // Simulate report generation
      const btn = event.target;
      const originalText = btn.textContent;
      
      btn.textContent = 'Generating...';
      btn.disabled = true;
      
      setTimeout(() => {
        btn.textContent = 'Report Generated ✓';
        btn.style.background = 'linear-gradient(135deg, #00ff88 0%, #00d4ff 100%)';
        
        setTimeout(() => {
          btn.textContent = originalText;
          btn.disabled = false;
          btn.style.background = 'rgba(255, 255, 255, 0.1)';
        }, 2000);
      }, 3000);
      
      // Create download link simulation
      const downloadLink = document.createElement('a');
      downloadLink.href = 'data:text/plain;charset=utf-8,' + encodeURIComponent(generateReportContent());
      downloadLink.download = 'portfolio_analysis_report.txt';
      downloadLink.style.display = 'none';
      document.body.appendChild(downloadLink);
      
      setTimeout(() => {
        downloadLink.click();
        document.body.removeChild(downloadLink);
      }, 3000);
    }

    function generateReportContent() {
      return `
WEALTHVISION AI - PORTFOLIO ANALYSIS REPORT
===========================================

Client: John Doe
Portfolio Value: $24.7M
Analysis Date: ${new Date().toLocaleDateString()}

EXECUTIVE SUMMARY
-----------------
Our advanced AI models recommend immediate portfolio rebalancing to optimize risk-adjusted returns. The current overweight position in Technology (45%) poses concentration risk given elevated market volatility.

KEY RECOMMENDATIONS
-------------------
1. Reduce Technology allocation from 45% to 25% (-20%)
2. Increase Healthcare allocation from 25% to 35% (+10%)
3. Increase Financial Services from 20% to 27% (+7%)
4. Increase Energy from 10% to 13% (+3%)

RISK METRICS
------------
- Current Sharpe Ratio: 0.87
- Projected Sharpe Ratio: 1.12
- Value at Risk (95%): $1.2M
- Maximum Drawdown: -8.7%
- Portfolio Beta: 0.94

MODEL CONFIDENCE
----------------
- AI Confidence Score: 87.4%
- Model Ensemble Agreement: 92%
- Backtesting Performance: 89% accuracy

This report is generated by WealthVision AI proprietary algorithms and should be reviewed with your financial advisor.
      `;
    }

    // Market data simulation
    function simulateMarketData() {
      const riskItems = document.querySelectorAll('.risk-score');
      const metrics = [
        { element: riskItems[0], base: 1.2, variance: 0.1, format: (v) => `${v.toFixed(1)}M` },
        { element: riskItems[1], base: 0.94, variance: 0.05, format: (v) => v.toFixed(2) },
        { element: riskItems[2], base: 14.2, variance: 1.0, format: (v) => `${v.toFixed(1)}%` },
        { element: riskItems[3], base: -8.7, variance: 0.5, format: (v) => `${v.toFixed(1)}%` },
        { element: riskItems[4], base: 0.73, variance: 0.03, format: (v) => v.toFixed(2) },
        { element: riskItems[5], base: 3.8, variance: 0.2, format: (v) => `${v.toFixed(1)}%` }
      ];
      
      setInterval(() => {
        metrics.forEach(metric => {
          if (metric.element) {
            const variation = (Math.random() - 0.5) * 2 * metric.variance;
            const newValue = metric.base + variation;
            metric.element.textContent = metric.format(newValue);
          }
        });
      }, 10000);
    }

    // Initialize all features
    document.addEventListener('DOMContentLoaded', function() {
      updatePortfolioData();
      simulateMarketData();
      
      // Add hover effects to metric cards
      const metricCards = document.querySelectorAll('.metric-card');
      metricCards.forEach(card => {
        card.addEventListener('mouseenter', function() {
          this.style.transform = 'translateY(-5px)';
          this.style.boxShadow = '0 10px 25px rgba(0, 212, 255, 0.2)';
        });
        
        card.addEventListener('mouseleave', function() {
          this.style.transform = 'translateY(0)';
          this.style.boxShadow = 'none';
        });
      });
      
      // Add loading animation for initial load
      setTimeout(() => {
        const elements = document.querySelectorAll('.animate-fade-in');
        elements.forEach((el, index) => {
          setTimeout(() => {
            el.style.opacity = '0';
            el.style.transform = 'translateY(20px)';
            el.style.transition = 'all 0.8s ease';
            
            setTimeout(() => {
              el.style.opacity = '1';
              el.style.transform = 'translateY(0)';
            }, 100);
          }, index * 200);
        });
      }, 100);
    });

    // Keyboard shortcuts
    document.addEventListener('keydown', function(e) {
      if (e.ctrlKey && e.key === 'e') {
        e.preventDefault();
        showExplanation();
      }
      if (e.ctrlKey && e.key === 'r') {
        e.preventDefault();
        generateReport();
      }
    });

    // --- Chatbot Logic ---
    const openChatbotBtn = document.getElementById('openChatbotBtn');
    const chatbotPanel = document.getElementById('chatbotPanel');
    const closeChatbotBtn = document.getElementById('closeChatbotBtn');
    const chatWindow = document.getElementById('chat-window');
    const chatForm = document.getElementById('chat-form');
    const userInput = document.getElementById('user-input');

    // Hardcoded chatflow state
    const chatSteps = [
      {
        user: /tech.*reduc|reduc.*tech|why.*reduc|why.*tech|recommend.*reduc|reduc.*recommend/i,
        bot: `Great question! The recommendation is based on a combination of your risk profile, market volatility, and recent earnings reports.<ul style='margin:0;padding-left:1.2em;'><li><b>Tech Sector Volatility:</b> SHAP = +0.42 → significant impact due to high variance last 7 days</li><li><b>Risk Profile:</b> SHAP = -0.33 → your profile indicates moderate risk tolerance</li><li><b>NASDAQ Outlook:</b> SHAP = +0.27 → negative forecast flagged</li></ul></details>`
      },
      {
        user: /confiden|how sure|certainty|confidence/i,
        bot: `We are currently <b>87.4% confident</b> in this recommendation, based on model consensus from multiple decision trees and volatility thresholds. Would you like to view how this was calculated?<br><button class='chat-btn' data-action='confidence'>🔍 View Confidence Breakdown</button>`
      },
      {
        user: /compare|other users|like me|similar/i,
        bot: `Compared to other clients with similar risk profiles, <b>71%</b> have seen better drawdown protection after reallocating out of Tech in similar conditions.`
      },
      {
        user: /simulate|what if|keep tech|counterfactual/i,
        bot: `Absolutely. Here's a counterfactual projection assuming no change to your Tech allocation…<br><button class='chat-btn' data-action='simulate'>📊 Show Simulation Chart</button><br>Expected downside risk increases by <b>3.1%</b> over the next quarter under volatile conditions.`
      }
    ];

    // For button actions
    const botActions = {
      confidence: `
        <b>Confidence Breakdown:</b><br>
        - Model Confidence: <b>87.4%</b><br>
        - Ensemble Agreement: <b>92%</b><br>
        - Action Threshold: <b>85%</b><br>
        - Volatility Trigger: <b>5.2%</b><br>
        <span style='color:#00d4ff;'>Confidence is calculated using ensemble voting and volatility thresholds.</span>
      `,
      simulate: `
        <b>Simulation Chart:</b><br>
        <canvas id='simChart' width='320' height='100' style='width:100%;max-width:320px;height:80px;background:rgba(0,0,0,0.12);border-radius:8px;margin:0.5em 0;display:block;'></canvas>
        <span>Expected downside risk increases by <b>3.1%</b> over the next quarter under volatile conditions.</span>
      `
    };

    let chatStep = 0;

    function appendMessage(sender, text, isLoading = false) {
      const msgDiv = document.createElement('div');
      msgDiv.style.display = 'flex';
      msgDiv.style.justifyContent = sender === 'user' ? 'flex-end' : 'flex-start';
      msgDiv.style.alignItems = 'flex-end';
      msgDiv.innerHTML = `<span class="chat-bubble ${sender === 'user' ? 'user-bubble' : 'bot-bubble'}">${text}</span>`;
      chatWindow.appendChild(msgDiv);
      chatWindow.scrollTop = chatWindow.scrollHeight;
      return msgDiv;
    }

    function nextBotMessage() {
      if (chatStep < chatSteps.length) {
        setTimeout(() => {
          appendMessage('bot', chatSteps[chatStep].bot);
          chatStep++;
        }, 800);
      }
    }

    chatForm.addEventListener('submit', function(e) {
      e.preventDefault();
      const text = userInput.value.trim();
      if (!text) return;
      appendMessage('user', text);
      userInput.value = '';
      // Find which step matches
      let matched = false;
      for (let i = chatStep; i < chatSteps.length; i++) {
        if (chatSteps[i].user.test(text)) {
          chatStep = i;
          matched = true;
          break;
        }
      }
      nextBotMessage();
    });

    // Handle chatbot open/close
    openChatbotBtn.addEventListener('click', function() {
      if (chatbotPanel.style.display === 'none' || chatbotPanel.style.display === '') {
        chatbotPanel.style.display = 'flex';
        setTimeout(() => {
          chatbotPanel.style.boxShadow = '0 8px 32px rgba(0,0,0,0.55)';
        }, 100);
        userInput.focus();
      } else {
        chatbotPanel.style.display = 'none';
      }
    });
    closeChatbotBtn.addEventListener('click', function() {
      chatbotPanel.style.display = 'none';
    });

    // Handle bot action buttons
    chatWindow.addEventListener('click', function(e) {
      if (e.target.classList.contains('chat-btn')) {
        const action = e.target.getAttribute('data-action');
        if (botActions[action]) {
          const msgDiv = appendMessage('bot', botActions[action]);
          // If simulation, draw chart
          if (action === 'simulate') {
            setTimeout(() => {
              const canvas = document.getElementById('simChart');
              if (canvas) {
                const ctx = canvas.getContext('2d');
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.strokeStyle = '#ff6b6b';
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.moveTo(10, 30);
                ctx.lineTo(60, 40);
                ctx.lineTo(120, 55);
                ctx.lineTo(180, 70);
                ctx.lineTo(250, 85);
                ctx.lineTo(310, 95);
                ctx.stroke();
                // Optionally, add axis
                ctx.strokeStyle = 'rgba(255,255,255,0.2)';
                ctx.lineWidth = 1;
                ctx.beginPath();
                ctx.moveTo(10, 95);
                ctx.lineTo(310, 95);
                ctx.moveTo(10, 10);
                ctx.lineTo(10, 95);
                ctx.stroke();
              }
            }, 100);
          }
        }
      }
    });

    // Chat bubble styles (injected for dark theme)
    const style = document.createElement('style');
    style.innerHTML = `
      .chat-bubble {
        display: inline-block;
        padding: 0.7rem 1.1rem;
        border-radius: 16px;
        font-size: 1rem;
        max-width: 80%;
        word-break: break-word;
        margin-bottom: 2px;
        box-shadow: 0 2px 8px rgba(0,212,255,0.05);
        transition: background 0.2s;
      }
      .user-bubble {
        background: linear-gradient(135deg, #0061f2 0%, #00d4ff 100%);
        color: #fff;
        align-self: flex-end;
      }
      .bot-bubble {
        background: rgba(255,255,255,0.08);
        color: #ccd6f6;
        align-self: flex-start;
      }
      .chat-btn {
        margin-top: 0.7em;
        background: linear-gradient(135deg, #0061f2 0%, #00d4ff 100%);
        color: #fff;
        border: none;
        border-radius: 8px;
        padding: 0.5em 1em;
        font-weight: 600;
        cursor: pointer;
        font-size: 0.95em;
        transition: background 0.2s;
        display: inline-block;
      }
      .chat-btn:hover {
        background: linear-gradient(135deg, #00d4ff 0%, #00ff88 100%);
      }
      #chatbotPanel::-webkit-scrollbar, #chat-window::-webkit-scrollbar {
        width: 8px;
        background: rgba(0,0,0,0.1);
      }
      #chatbotPanel::-webkit-scrollbar-thumb, #chat-window::-webkit-scrollbar-thumb {
        background: rgba(0,212,255,0.18);
        border-radius: 4px;
      }
      @media (max-width: 600px) {
        #chatbotPanel {
          width: 98vw !important;
          right: 1vw !important;
          height: 60vh !important;
          bottom: 1rem !important;
        }
      }
      #chatbotResizeHandle {
        position: absolute;
        width: 24px;
        height: 24px;
        right: 2px;
        bottom: 2px;
        cursor: se-resize;
        z-index: 10;
        background: none;
      }
      #chatbotResizeHandle::after {
        content: '';
        display: block;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, #00d4ff 0%, #0061f2 100%);
        opacity: 0.5;
        border-radius: 6px;
        clip-path: polygon(100% 0, 0 100%, 100% 100%);
      }
      #chatbotHeader {
        cursor: move;
        user-select: none;
      }
    `;
    document.head.appendChild(style);

    // --- Chatbot Dragging Logic ---
    (function() {
      const panel = document.getElementById('chatbotPanel');
      const header = document.getElementById('chatbotHeader');
      let isDragging = false;
      let offsetX = 0, offsetY = 0;
      let startLeft, startTop;
      header.addEventListener('mousedown', function(e) {
        if (e.target.id === 'closeChatbotBtn') return; // Don't drag if clicking close
        isDragging = true;
        // Get current position
        const rect = panel.getBoundingClientRect();
        offsetX = e.clientX - rect.left;
        offsetY = e.clientY - rect.top;
        startLeft = rect.left;
        startTop = rect.top;
        document.body.style.userSelect = 'none';
      });
      document.addEventListener('mousemove', function(e) {
        if (!isDragging) return;
        let newLeft = e.clientX - offsetX;
        let newTop = e.clientY - offsetY;
        // Keep within viewport
        const minLeft = 0;
        const minTop = 0;
        const maxLeft = window.innerWidth - panel.offsetWidth;
        const maxTop = window.innerHeight - panel.offsetHeight;
        newLeft = Math.max(minLeft, Math.min(maxLeft, newLeft));
        newTop = Math.max(minTop, Math.min(maxTop, newTop));
        panel.style.left = newLeft + 'px';
        panel.style.top = newTop + 'px';
        panel.style.right = '';
        panel.style.bottom = '';
        panel.style.position = 'fixed';
      });
      document.addEventListener('mouseup', function() {
        if (isDragging) {
          isDragging = false;
          document.body.style.userSelect = '';
        }
      });
    })();

    // --- Chatbot Resizing Logic ---
    (function() {
      const panel = document.getElementById('chatbotPanel');
      const resizeHandle = document.getElementById('chatbotResizeHandle');
      let isResizing = false;
      let startWidth, startHeight, startX, startY;
      const minWidth = 300;
      const minHeight = 350;
      const maxWidth = 600;
      const maxHeight = 800;

      resizeHandle.addEventListener('mousedown', function(e) {
        e.preventDefault();
        isResizing = true;
        const rect = panel.getBoundingClientRect();
        startWidth = rect.width;
        startHeight = rect.height;
        startX = e.clientX;
        startY = e.clientY;
        document.body.style.userSelect = 'none';
      });
      document.addEventListener('mousemove', function(e) {
        if (!isResizing) return;
        let newWidth = startWidth + (e.clientX - startX);
        let newHeight = startHeight + (e.clientY - startY);
        newWidth = Math.max(minWidth, Math.min(maxWidth, newWidth));
        newHeight = Math.max(minHeight, Math.min(maxHeight, newHeight));
        panel.style.width = newWidth + 'px';
        panel.style.height = newHeight + 'px';
        panel.style.maxWidth = '95vw';
        panel.style.maxHeight = '95vh';
      });
      document.addEventListener('mouseup', function() {
        if (isResizing) {
          isResizing = false;
          document.body.style.userSelect = '';
        }
      });
    })();

    // Optionally, greet user with first step
    setTimeout(() => {
      appendMessage('bot', 'Hi! Ask me about your portfolio recommendations, confidence, or simulations.');
    }, 500);
  </script>
</body>
</html>
